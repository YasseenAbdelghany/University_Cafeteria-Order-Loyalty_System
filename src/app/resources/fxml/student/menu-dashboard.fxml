<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane styleClass="root" stylesheets="@../../css/themes/student-theme.css" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="app.gui.student.controllers.MenuDashboardController">
    
    <!-- Top: Enhanced Header with Student Info and Quick Actions -->
    <top>
        <VBox styleClass="header-section">
            <!-- Welcome Banner for New Registrations (Hidden by default) -->
            <HBox fx:id="welcomeBanner" alignment="CENTER" managed="false" spacing="15" styleClass="welcome-banner" visible="false">
                <padding>
                    <Insets bottom="15" left="25" right="25" top="15" />
                </padding>
                <Label styleClass="welcome-icon" text="ðŸŽ‰">
                    <font>
                        <Font size="32" />
                    </font>
                </Label>
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label fx:id="welcomeTitle" styleClass="welcome-banner-title" text="Welcome to our Cafeteria!">
                        <font>
                            <Font name="System Bold" size="20" />
                        </font>
                    </Label>
                    <Label fx:id="welcomeMessage" styleClass="welcome-banner-message" text="Your student code is: ST001 - Please save this for future logins!">
                        <font>
                            <Font size="14" />
                        </font>
                    </Label>
                </VBox>
                <Button onAction="#handleCloseBanner" styleClass="close-banner-button" text="âœ•">
                    <font>
                        <Font name="System Bold" size="18" />
                    </font>
                    <tooltip>
                        <Tooltip text="Close" />
                    </tooltip>
                </Button>
            </HBox>

            <!-- Main Header Row -->
            <HBox alignment="CENTER_LEFT" spacing="25">
                <!-- Student Info Section -->
                <VBox spacing="6" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="12">
                        <Label styleClass="logo-emoji-small" text="ðŸ½ï¸">
                            <font>
                                <Font size="32" />
                            </font>
                        </Label>
                        <VBox spacing="3">
                            <Label styleClass="header-label-dashboard" text="Menu Dashboard">
                                <font>
                                    <Font name="System Bold" size="28" />
                                </font>
                            </Label>
                        </VBox>
                    </HBox>
                      <Label fx:id="studentInfoLabel" prefHeight="20.0" prefWidth="466.0" styleClass="subheader-label" text="Student: Loading...">
                          <font>
                              <Font name="System Bold Italic" size="40.0" />
                          </font>
                      </Label>
                </VBox>

                <!-- Quick Stats and Actions -->
                <HBox alignment="CENTER_RIGHT" spacing="15">
                    <!-- Loyalty Points Badge -->
                    <VBox alignment="CENTER" spacing="5" styleClass="stats-card">
                        <padding>
                            <Insets bottom="12" left="18" right="18" top="12" />
                        </padding>
                        <Label styleClass="stats-icon" text="ðŸ’Ž">
                            <font>
                                <Font size="24" />
                            </font>
                        </Label>
                        <Label fx:id="loyaltyPointsLabel" styleClass="stats-value" text="0 Points">
                            <font>
                                <Font name="System Bold" size="16" />
                            </font>
                        </Label>
                        <Label styleClass="stats-label" text="Loyalty Points">
                            <font>
                                <Font size="11" />
                            </font>
                        </Label>
                    </VBox>

                    <!-- Notifications Button with Badge -->
                    <StackPane>
                        <Label fx:id="notificationBadge" managed="false" styleClass="notification-badge-top" text="0" visible="false" StackPane.alignment="TOP_RIGHT">
                            <StackPane.margin>
                                <Insets right="2" top="2" />
                            </StackPane.margin>
                        </Label>
                  <AnchorPane prefHeight="59.0" prefWidth="86.0">
                     <children>
                              <Button fx:id="notificationButton" layoutX="-16.0" layoutY="55.0" onAction="#handleViewNotifications" prefHeight="51.0" prefWidth="59.0" styleClass="icon-button-large" text="ðŸ””">
                                  <font>
                                      <Font size="24" />
                                  </font>
                                  <tooltip>
                                      <Tooltip text="View Notifications" />
                                  </tooltip>
                              </Button>
                     </children>
                  </AnchorPane>
                    </StackPane>
                </HBox>
            </HBox>

            <padding>
                <Insets bottom="25" left="25" right="25" top="25" />
            </padding>
        </VBox>
    </top>
    
    <!-- Center: Menu Items with Modern Card Layout -->
    <center>
        <VBox spacing="15" styleClass="content-section">
            <padding>
                <Insets bottom="15" left="20" right="20" top="15" />
            </padding>
            
            <!-- Section Header -->
            <HBox alignment="CENTER_LEFT" spacing="12">
                <Label styleClass="section-emoji" text="ðŸ”">
                    <font>
                        <Font size="24" />
                    </font>
                </Label>
                <Label styleClass="section-title" text="Available Menu Items">
                    <font>
                        <Font name="System Bold" size="22" />
                    </font>
                </Label>
                <Region HBox.hgrow="ALWAYS" />
                <Label styleClass="section-subtitle" text="Browse and add items to your cart">
                    <font>
                        <Font size="13" />
                    </font>
                </Label>
            </HBox>

            <!-- Menu Table with Enhanced Styling -->
            <TableView fx:id="menuTableView" styleClass="table-view-modern" VBox.vgrow="ALWAYS">
                <columns>
                    <TableColumn fx:id="idColumn" prefWidth="60" styleClass="table-column-header" text="ID" />
                    <TableColumn fx:id="nameColumn" prefWidth="180" styleClass="table-column-header" text="ðŸ• Item Name" />
                    <TableColumn fx:id="descriptionColumn" prefWidth="220" styleClass="table-column-header" text="ðŸ“ Description" />
                    <TableColumn fx:id="priceColumn" prefWidth="100" styleClass="table-column-header" text="ðŸ’° Price" />
                    <TableColumn fx:id="categoryColumn" prefWidth="120" styleClass="table-column-header" text="ðŸ·ï¸ Category" />
                    <TableColumn fx:id="quantityColumn" prefWidth="110" styleClass="table-column-header" text="ðŸ”¢ Qty" />
                    <TableColumn fx:id="actionColumn" prefWidth="120" styleClass="table-column-header" text="âž• Action" />
                </columns>
                <columnResizePolicy>
                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                </columnResizePolicy>
            </TableView>
        </VBox>
    </center>
    
    <!-- Right: Shopping Cart with Enhanced Design -->
    <right>
        <VBox prefWidth="340" spacing="18" styleClass="cart-panel">
            <padding>
                <Insets bottom="25" left="25" right="25" top="25" />
            </padding>

            <!-- Cart Header -->
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label styleClass="cart-icon" text="ðŸ›’">
                    <font>
                        <Font size="28" />
                    </font>
                </Label>
                <Label styleClass="cart-title" text="Shopping Cart">
                    <font>
                        <Font name="System Bold" size="20" />
                    </font>
                </Label>
            </HBox>

            <Separator styleClass="cart-separator" />

            <!-- Cart Items List with Custom Styling -->
            <VBox spacing="8">
                <Label styleClass="cart-section-label" text="Your Items">
                    <font>
                        <Font name="System Bold" size="13" />
                    </font>
                </Label>
                <ListView fx:id="cartListView" prefHeight="250" styleClass="cart-list" VBox.vgrow="ALWAYS" />
            </VBox>

            <Separator styleClass="cart-separator" />

            <!-- Order Summary with Modern Card -->
            <VBox spacing="12" styleClass="summary-card">
                <padding>
                    <Insets bottom="15" left="15" right="15" top="15" />
                </padding>

                <Label styleClass="summary-title" text="Order Summary">
                    <font>
                        <Font name="System Bold" size="15" />
                    </font>
                </Label>

                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label styleClass="summary-label" text="Subtotal:">
                        <font>
                            <Font size="13" />
                        </font>
                    </Label>
                    <Region HBox.hgrow="ALWAYS" />
                    <Label fx:id="subtotalLabel" styleClass="summary-value" text="0.00 EGP">
                        <font>
                            <Font name="System Bold" size="13" />
                        </font>
                    </Label>
                </HBox>
                
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label styleClass="summary-label-discount" text="Discount:">
                        <font>
                            <Font size="13" />
                        </font>
                    </Label>
                    <Region HBox.hgrow="ALWAYS" />
                    <Label fx:id="discountLabel" styleClass="summary-value-discount" text="0.00 EGP">
                        <font>
                            <Font name="System Bold" size="13" />
                        </font>
                    </Label>
                </HBox>
                
                <Separator styleClass="summary-separator" />

                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label styleClass="summary-total-label" text="Total:">
                        <font>
                            <Font name="System Bold" size="16" />
                        </font>
                    </Label>
                    <Region HBox.hgrow="ALWAYS" />
                    <Label fx:id="totalLabel" styleClass="summary-total-value" text="0.00 EGP">
                        <font>
                            <Font name="System Bold" size="18" />
                        </font>
                    </Label>
                </HBox>
            </VBox>
            
            <!-- Action Buttons -->
            <VBox spacing="12">
                <Button fx:id="checkoutButton" disable="true" maxWidth="Infinity" onAction="#handleCheckout" prefHeight="48" styleClass="checkout-button" text="ðŸ’³ Proceed to Checkout">
                    <font>
                        <Font name="System Bold" size="14" />
                    </font>
                </Button>

                <Button maxWidth="Infinity" onAction="#handleViewOrderHistory" prefHeight="40" styleClass="secondary-button-modern" text="ðŸ“œ View Order History">
                    <font>
                        <Font size="13" />
                    </font>
                </Button>

                <Button maxWidth="Infinity" onAction="#handleLogout" prefHeight="40" styleClass="logout-button" text="ðŸšª Logout">
                    <font>
                        <Font size="13" />
                    </font>
                </Button>
            </VBox>
        </VBox>
    </right>
    
</BorderPane>
